# https://github.com/GoogleCloudPlatform/cloud-sdk-docker/tags
FROM gcr.io/google.com/cloudsdktool/google-cloud-cli:427.0.0

RUN apt update \
  && DEBIAN_FRONTEND=noninteractive apt install -y \
  curl git curl ca-certificates git-crypt gnupg openssl openssh-server python3 sudo \
  && apt clean \
  && /bin/rm -rf /var/lib/apt/lists/*

RUN mkdir -p /etc/apt/keyrings && curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg

RUN echo "deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_18.x nodistro main" > /etc/apt/sources.list.d/nodesource.list

RUN apt update \
  && DEBIAN_FRONTEND=noninteractive apt install -y \
  nodejs \
  && apt clean \
  && /bin/rm -rf /var/lib/apt/lists/*

RUN npm install -g firebase-tools

WORKDIR /repo

USER cloudsdk

RUN curl -L https://fly.io/install.sh | sh
RUN echo export PATH='"'/home/cloudsdk/.fly/bin:'/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/usr/lib/wsl/lib:/mnt/c/Program Files (x86)/Common Files/Oracle/Java/javapath:/mnt/c/Program Files (x86)/Razer Chroma SDK/bin:/mnt/c/Program Files/Razer Chroma SDK/bin:/mnt/c/Program Files (x86)/Razer/ChromaBroadcast/bin:/mnt/c/Program Files/Razer/ChromaBroadcast/bin:/mnt/c/Windows/system32:/mnt/c/Windows:/mnt/c/Windows/System32/Wbem:/mnt/c/Windows/System32/WindowsPowerShell/v1.0/:/mnt/c/Windows/System32/OpenSSH/:/mnt/c/Program Files (x86)/NVIDIA Corporation/PhysX/Common:/mnt/c/Program Files/NVIDIA Corporation/NVIDIA NvDLISR:/mnt/c/WINDOWS/system32:/mnt/c/WINDOWS:/mnt/c/WINDOWS/System32/Wbem:/mnt/c/WINDOWS/System32/WindowsPowerShell/v1.0/:/mnt/c/WINDOWS/System32/OpenSSH/:/mnt/c/Program Files/Git/cmd:/mnt/c/MinGW/mingw32/bin:/mnt/c/WINDOWS/system32/config/systemprofile/AppData/Local/Microsoft/WindowsApps:/mnt/c/Users/ClayT/sqlite-tools/sqlite-tools-win32-x86-3420000:/mnt/c/ProgramData/chocolatey/bin:/mnt/c/MinGW/bin:/mnt/c/Program Files (x86)/GnuPG/bin:/mnt/c/msys64/mingw64/bin:/mnt/c/Program Files (x86)/Java/openlogic-openjdk-8u382-b05-windows-64/bin:/mnt/c/Program Files/Docker/Docker/resources/bin:/mnt/c/Users/ClayT/AppData/Local/Microsoft/WindowsApps:/mnt/c/Users/ClayT/AppData/Local/Programs/Microsoft VS Code/bin:/snap/bin:/home/clayton-h/.fly/bin''"' >> /home/cloudsdk/.bashrc

CMD firebase emulators:start --project "devops-fall2023-notes" --config firebase.json.test --import /var/lib/firebase/data --export-on-exit /var/lib/firebase/data
# CMD bash -c "while true ; do date ; sleep 30 ; done"

